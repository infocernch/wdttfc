<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="news">
<!-- 리스트 -->
 <select id="list" resultType="wdtt.dto.WdttNewsDTO">
 WITH numbered_table AS (
  SELECT num, writer, join_date, title, readcount, content,show,
         ROW_NUMBER() OVER (ORDER BY num DESC) AS row_num
  FROM wdttnews
)
SELECT num, writer, join_date, title, readcount, content,show
FROM numbered_table
WHERE row_num BETWEEN #{start} AND #{end}
 </select>
 
  <!-- 게시물 갯수 계산  -->
 <select id="count" resultType="int">
  select count(*) from wdttnews
 </select>
 
 <insert id="insertNews">
 	insert into wdttnews(num,writer,title,content,filename)
	values((select nvl(max(num)+1,1)from wdttnews),#{writer},#{title},#{content},#{filename})
 </insert>
 
 <select id="viewNews" resultType="wdtt.dto.WdttNewsDTO">
 select num,writer,join_date,title,readcount,content,filename,filesize,readcount
 from wdttnews
 where num=#{num}
 </select>
 
 <update id="readcount">
   update wdttnews set readcount=readcount+1 where num=#{num}
 </update>
 
 <select id="getFileName" resultType="String">
  select filename from wdttnews where num=#{num}
 </select>
 
 <select id="myWrite" resultType="wdtt.dto.WdttNewsDTO">
  WITH numbered_table AS (
  SELECT num, writer, join_date, title, readcount, content,show,
         ROW_NUMBER() OVER (ORDER BY num DESC) AS row_num
  FROM wdttnews
 )
 SELECT num, writer, join_date, title, readcount, content,show
 FROM numbered_table
 WHERE writer = #{userid} AND row_num BETWEEN #{start} AND #{end}
 </select>
 <select id="modify" resultType="wdtt.dto.WdttNewsDTO">
 select num,writer,join_date,title,readcount,content,filename,filesize
 from wdttnews
 where num=#{num} and writer=#{userid}
 </select>
 
 <update id="update">
   update wdttnews
		set writer=#{writer}, title=#{title}
			, content=#{content}, filename=#{filename}
			, filesize=#{filesize}
		where num=#{num}
 </update>
 <update id="delete">
  update wdttnews
   set show='n'
   where num=#{num}
 </update>
</mapper>
